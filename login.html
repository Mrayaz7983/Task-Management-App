
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Task Tracker</title>
  <link rel="stylesheet" href="style.css">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Login/Register Modal -->
  <div id="login-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <img src="https://img.icons8.com/color/96/000000/task.png" alt="Task Tracker" class="modal-logo">
        <h2 id="modal-title">Login</h2>
      </div>
      <input type="email" id="login-email" placeholder="Email" required>
      <input type="password" id="login-password" placeholder="Password" required>
      <input type="password" id="register-password2" placeholder="Confirm Password" style="display:none;">
      <button id="login-btn" onclick="login()">Login</button>
      <button id="register-btn" onclick="register()" style="display:none;">Register</button>
      <p id="login-error" class="modal-error"></p>
      <p id="login-success" class="modal-success"></p>
      <div class="modal-switch">
        <span id="switch-to-register" style="display:inline;">Don't have an account? <a href="#" onclick="showRegister()">Register</a></span>
        <span id="switch-to-login" style="display:none;">Already have an account? <a href="#" onclick="showLogin()">Login</a></span>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar" style="display:none;">
    <h2 class="logo">Task Tracker</h2>
    <ul class="nav-links">
      <li><a href="#" onclick="showSection('dashboard');return false;">Dashboard</a></li>
      <li><a href="#" onclick="showSection('add-task');return false;">Add Task</a></li>
      <li><a href="#" onclick="showSection('task-board');return false;">Task Board</a></li>
      <li><a href="#" onclick="showSection('profile');return false;">Profile</a></li>
      <li><a href="#" onclick="logout()">Logout</a></li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="main-content" style="display:none;">
    <!-- Top Navbar -->
    <div class="navbar">
      <h3>Welcome, <span id="user-email">User</span>!</h3>
    </div>

    <!-- Dashboard Section -->
    <div id="section-dashboard">
      <div class="cards">
        <div class="card today-card">
          <h4>Today</h4>
          <p id="today-date"></p>
        </div>
        <div class="card task-card">
          <h4>Task</h4>
          <p>Manage your tasks</p>
        </div>
      </div>
      <!-- Dashboard Tasks Summary -->
      <div id="dashboard-tasks" class="dashboard-tasks"></div>
    </div>

    <!-- Add Task Section -->
    <div id="section-add-task" style="display:none;">
      <div class="add-task">
        <h3 id="add-task-title">Add New Task</h3>
        <input type="text" id="task-title" placeholder="Task Title">
        <input type="text" id="task-desc" placeholder="Task Description">
        <input type="text" id="assigned-to" placeholder="Assign To">
        <button type="button" id="create-task-btn" onclick="createTask(event)">Create Task</button>
        <button type="button" id="update-task-btn" onclick="updateTask(event)" style="display:none;">Update Task</button>
        <button type="button" id="cancel-edit-btn" onclick="cancelEdit()" style="display:none;background:#f87171;">Cancel</button>
        <p id="task-error" style="color:red;"></p>
        <p id="task-success" style="color:green;"></p>
      </div>
    </div>

    <!-- Task Board Section -->
    <div id="section-task-board" style="display:none;">
      <div class="task-board">
        <div class="column" id="todo">
          <h2>To Do</h2>
          <div id="todo-tasks"></div>
        </div>
        <div class="column" id="inprogress">
          <h2>In Progress</h2>
          <div id="inprogress-tasks"></div>
        </div>
        <div class="column" id="done">
          <h2>Done</h2>
          <div id="done-tasks"></div>
        </div>
      </div>
      <div id="loading-tasks" class="loading" style="display:none;">Loading tasks...</div>
    </div>

    <!-- Profile Section -->
    <div id="section-profile" style="display:none;">
      <div class="card" style="max-width:400px;margin:32px auto;">
        <h3>Profile</h3>
        <p><strong>Email:</strong> <span id="profile-email"></span></p>
        <p><strong>User ID:</strong> <span id="profile-uid"></span></p>
      </div>
    </div>
  </div>

  <!-- Firebase Script -->
  <script>
    // ==== Firebase Config ====
    const firebaseConfig = {
      apiKey: "AIzaSyCreY0yJPlnyY-RaONxxbKzACzVswtehqo",
      authDomain: "task-management-8e279.firebaseapp.com",
      projectId: "task-management-8e279",
      storageBucket: "task-management-8e279.appspot.com",
      messagingSenderId: "1097228320616",
      appId: "1:1097228320616:web:caf4a8bb587e1bca0aa0dd"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ==== UI Elements ====
    const loginModal = document.getElementById('login-modal');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('main-content');
    const userEmailSpan = document.getElementById('user-email');
    const loginError = document.getElementById('login-error');
    const loginSuccess = document.getElementById('login-success');
    const loginBtn = document.getElementById('login-btn');
    const registerBtn = document.getElementById('register-btn');
    const modalTitle = document.getElementById('modal-title');
    const password2 = document.getElementById('register-password2');
    const switchToRegister = document.getElementById('switch-to-register');
    const switchToLogin = document.getElementById('switch-to-login');
    const taskError = document.getElementById('task-error');
    const taskSuccess = document.getElementById('task-success');
    const loadingTasks = document.getElementById('loading-tasks');
    const addTaskTitle = document.getElementById('add-task-title');
    const createTaskBtn = document.getElementById('create-task-btn');
    const updateTaskBtn = document.getElementById('update-task-btn');
    const cancelEditBtn = document.getElementById('cancel-edit-btn');
    const profileEmail = document.getElementById('profile-email');
    const profileUid = document.getElementById('profile-uid');

    let unsubscribeTasks = null;
    let editingTaskId = null;

    // ==== Section Show/Hide Logic ====
    function showSection(section) {
      document.getElementById('section-dashboard').style.display = section === 'dashboard' ? '' : 'none';
      document.getElementById('section-add-task').style.display = section === 'add-task' ? '' : 'none';
      document.getElementById('section-task-board').style.display = section === 'task-board' ? '' : 'none';
      document.getElementById('section-profile').style.display = section === 'profile' ? '' : 'none';
      // If profile, update info
      if (section === 'profile' && auth.currentUser) {
        profileEmail.textContent = auth.currentUser.email;
        profileUid.textContent = auth.currentUser.uid;
      }
    }

    // ==== Auth State Listener ====
    auth.onAuthStateChanged(user => {
      if (user) {
        loginModal.style.display = 'none';
        sidebar.style.display = 'block';
        mainContent.style.display = 'block';
        userEmailSpan.textContent = user.email;
        clearModal();
        subscribeTasks();
        showSection('dashboard'); // Default to dashboard on login
      } else {
        loginModal.style.display = 'block';
        sidebar.style.display = 'none';
        mainContent.style.display = 'none';
        userEmailSpan.textContent = '';
        clearModal();
        showLogin();
        if (unsubscribeTasks) unsubscribeTasks();
        // Clear dashboard tasks on logout
        const dashboardTasks = document.getElementById('dashboard-tasks');
        if (dashboardTasks) dashboardTasks.innerHTML = "";
        // Clear task board columns on logout
        ['todo-tasks', 'inprogress-tasks', 'done-tasks'].forEach(id => {
          const col = document.getElementById(id);
          if (col) col.innerHTML = "";
        });
      }
    });

    // ==== Login Function ====
    window.login = function() {
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      loginError.textContent = '';
      loginSuccess.textContent = '';
      if (!email || !password) {
        loginError.textContent = "Please enter email and password.";
        return;
      }
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          loginSuccess.textContent = "Login successful!";
        })
        .catch(error => {
          loginError.textContent = error.message;
        });
    };

    // ==== Register Function ====
    window.register = function() {
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      const passwordConfirm = document.getElementById('register-password2').value;
      loginError.textContent = '';
      loginSuccess.textContent = '';
      if (!email || !password || !passwordConfirm) {
        loginError.textContent = "Please fill all fields.";
        return;
      }
      if (password !== passwordConfirm) {
        loginError.textContent = "Passwords do not match.";
        return;
      }
      if (password.length < 6) {
        loginError.textContent = "Password should be at least 6 characters.";
        return;
      }
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => {
          loginSuccess.textContent = "Registration successful!";
        })
        .catch(error => {
          loginError.textContent = error.message;
        });
    };

    // ==== Logout Function ====
    window.logout = function() {
      auth.signOut();
    };

    // ==== Toggle Modal: Login/Register ====
    window.showRegister = function() {
      modalTitle.textContent = "Register";
      loginBtn.style.display = "none";
      registerBtn.style.display = "block";
      password2.style.display = "block";
      switchToRegister.style.display = "none";
      switchToLogin.style.display = "inline";
      clearModal();
    };
    window.showLogin = function() {
      modalTitle.textContent = "Login";
      loginBtn.style.display = "block";
      registerBtn.style.display = "none";
      password2.style.display = "none";
      switchToRegister.style.display = "inline";
      switchToLogin.style.display = "none";
      clearModal();
    };
    function clearModal() {
      loginError.textContent = "";
      loginSuccess.textContent = "";
      document.getElementById('login-password').value = "";
      if (password2) password2.value = "";
    }

    // ==== Today's Date ====
    document.addEventListener('DOMContentLoaded', () => {
      const todayDate = document.getElementById('today-date');
      if (todayDate) {
        const today = new Date();
        todayDate.textContent = today.toLocaleDateString();
      }
    });

    // ==== Create Task ====
    window.createTask = async function(event) {
      taskError.textContent = "";
      taskSuccess.textContent = "";
      const title = document.getElementById('task-title').value.trim();
      const desc = document.getElementById('task-desc').value.trim();
      const assignedTo = document.getElementById('assigned-to').value.trim();
      if (!title || !desc || !assignedTo) {
        taskError.textContent = "Please fill all fields.";
        return;
      }
      const user = auth.currentUser;
      if (!user) {
        taskError.textContent = "You must be logged in.";
        return;
      }
      createTaskBtn.disabled = true;
      try {
        await db.collection('tasks').add({
          title,
          desc,
          assignedTo,
          status: 'todo',
          createdBy: user.uid,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        document.getElementById('task-title').value = "";
        document.getElementById('task-desc').value = "";
        document.getElementById('assigned-to').value = "";
        taskSuccess.textContent = "Task created!";
      } catch (err) {
        taskError.textContent = "Error creating task: " + err.message;
      }
      createTaskBtn.disabled = false;
    };

    // ==== Edit Task ====
    window.editTask = function(taskId, task) {
      editingTaskId = taskId;
      document.getElementById('task-title').value = task.title;
      document.getElementById('task-desc').value = task.desc;
      document.getElementById('assigned-to').value = task.assignedTo;
      addTaskTitle.textContent = "Edit Task";
      createTaskBtn.style.display = "none";
      updateTaskBtn.style.display = "inline-block";
      cancelEditBtn.style.display = "inline-block";
      taskError.textContent = "";
      taskSuccess.textContent = "";
      showSection('add-task');
    };

    window.cancelEdit = function() {
      editingTaskId = null;
      document.getElementById('task-title').value = "";
      document.getElementById('task-desc').value = "";
      document.getElementById('assigned-to').value = "";
      addTaskTitle.textContent = "Add New Task";
      createTaskBtn.style.display = "inline-block";
      updateTaskBtn.style.display = "none";
      cancelEditBtn.style.display = "none";
      taskError.textContent = "";
      taskSuccess.textContent = "";
    };

    window.updateTask = async function(event) {
      taskError.textContent = "";
      taskSuccess.textContent = "";
      if (!editingTaskId) return;
      const title = document.getElementById('task-title').value.trim();
      const desc = document.getElementById('task-desc').value.trim();
      const assignedTo = document.getElementById('assigned-to').value.trim();
      if (!title || !desc || !assignedTo) {
        taskError.textContent = "Please fill all fields.";
        return;
      }
      updateTaskBtn.disabled = true;
      try {
        await db.collection('tasks').doc(editingTaskId).update({
          title, desc, assignedTo
        });
        taskSuccess.textContent = "Task updated!";
        window.cancelEdit();
      } catch (err) {
        taskError.textContent = "Error updating task: " + err.message;
      }
      updateTaskBtn.disabled = false;
    };

    // ==== Real-time Task Subscription ====
    function subscribeTasks() {
  const user = auth.currentUser;
  if (!user) return;
  loadingTasks.style.display = "block";
  if (unsubscribeTasks) unsubscribeTasks();
  unsubscribeTasks = db.collection('tasks')
    .where('createdBy', '==', user.uid)
    .orderBy('createdAt', 'desc')
    .onSnapshot(snapshot => {
      // Always clear columns if they exist
      const todoTasksDiv = document.getElementById('todo-tasks');
      const inprogressTasksDiv = document.getElementById('inprogress-tasks');
      const doneTasksDiv = document.getElementById('done-tasks');
      if (todoTasksDiv) todoTasksDiv.innerHTML = "";
      if (inprogressTasksDiv) inprogressTasksDiv.innerHTML = "";
      if (doneTasksDiv) doneTasksDiv.innerHTML = "";

      // Collect tasks for dashboard and board
      let tasks = [];
      snapshot.forEach(doc => {
        const task = doc.data();
        const taskWithId = { ...task, id: doc.id };
        tasks.push(taskWithId);

        // Render to Task Board columns if present
        let colDiv = null;
        if (task.status === 'todo') colDiv = todoTasksDiv;
        else if (task.status === 'inprogress') colDiv = inprogressTasksDiv;
        else if (task.status === 'done') colDiv = doneTasksDiv;
        if (colDiv) {
          const taskDiv = document.createElement('div');
          taskDiv.className = "task-item";
          taskDiv.innerHTML = `
            <strong>${escapeHtml(task.title)}</strong><br>
            <span>${escapeHtml(task.desc)}</span><br>
            <small>Assigned to: ${escapeHtml(task.assignedTo)}</small><br>
            <div class="task-actions">
              <button onclick="editTask('${doc.id}', ${JSON.stringify(taskWithId).replace(/"/g, '&quot;')})">Edit</button>
              ${task.status !== 'todo' ? `<button onclick="updateTaskStatus('${doc.id}', 'todo')">To Do</button>` : ''}
              ${task.status !== 'inprogress' ? `<button onclick="updateTaskStatus('${doc.id}', 'inprogress')">In Progress</button>` : ''}
              ${task.status !== 'done' ? `<button onclick="updateTaskStatus('${doc.id}', 'done')">Done</button>` : ''}
              <button onclick="deleteTask('${doc.id}')">Delete</button>
            </div>
          `;
          colDiv.appendChild(taskDiv);
        }
      });
      showDashboardTasks(tasks);
      loadingTasks.style.display = "none";
    }, err => {
      loadingTasks.style.display = "none";
      alert("Error loading tasks: " + err.message);
    });
}

    // ==== HTML Escape Utility ====
    function escapeHtml(text) {
      if (!text) return "";
      return text.replace(/[&<>"']/g, function(m) {
        return ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        })[m];
      });
    }
    
// ==== Update Task Status ====
window.updateTaskStatus = async function(taskId, newStatus) {
  try {
    await db.collection('tasks').doc(taskId).update({
      status: newStatus
    });
    // Optionally, show a success message or visual feedback
  } catch (err) {
    alert("Error updating task status: " + err.message);
  }
};

// ==== Delete Task ====
window.deleteTask = async function(taskId) {
  if (!confirm("Are you sure you want to delete this task?")) return;
  try {
    await db.collection('tasks').doc(taskId).delete();
    // Optionally, show a success message or visual feedback
  } catch (err) {
    alert("Error deleting task: " + err.message);
  }
};

    
  </script>

<style>
  .modal {
    display: block;
    position: fixed;
    z-index: 1000;
    left: 0; top: 0; width: 100%; height: 100%;
    overflow: auto; background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
    transition: background 0.3s;
  }
  .dashboard-tasks {
    margin-top: 24px;
    max-width: 600px;
  }
  .dashboard-task-item {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 1px 4px #e0e7ff;
    padding: 10px 12px;
    margin-bottom: 8px;
    font-size: 1rem;
    word-break: break-word;
  }
  .modal-content {
    background: #fff;
    margin: 6% auto;
    padding: 32px 32px 24px 32px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(60,60,120,0.15);
    width: 340px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    align-items: center;
    position: relative;
    animation: modalFadeIn 0.6s;
  }
  @keyframes modalFadeIn {
    from { opacity: 0; transform: translateY(-40px);}
    to { opacity: 1; transform: translateY(0);}
  }
  .modal-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }
  .modal-logo {
    width: 56px;
    height: 56px;
    margin-bottom: 4px;
    filter: drop-shadow(0 2px 8px #e0e7ff);
  }
  .modal-content input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #c7d2fe;
    border-radius: 6px;
    font-size: 1rem;
    background: #f1f5f9;
    transition: border 0.2s;
  }
  .modal-content input:focus {
    border: 1.5px solid #6366f1;
    outline: none;
    background: #fff;
  }
  .modal-content button {
    width: 100%;
    padding: 10px;
    background: linear-gradient(90deg, #6366f1 0%, #818cf8 100%);
    color: #fff;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    margin-top: 4px;
    box-shadow: 0 2px 8px #e0e7ff;
    transition: background 0.2s;
  }
  .modal-content button:hover {
    background: linear-gradient(90deg, #4f46e5 0%, #6366f1 100%);
  }
  .modal-error {
    color: #ef4444;
    font-size: 0.95rem;
    min-height: 20px;
    margin: 0;
    text-align: center;
  }
  .modal-success {
    color: #22c55e;
    font-size: 0.95rem;
    min-height: 20px;
    margin: 0;
    text-align: center;
  }
  .modal-switch {
    font-size: 0.97rem;
    color: #64748b;
    margin-top: 4px;
    text-align: center;
  }
  .modal-switch a {
    color: #6366f1;
    text-decoration: underline;
    cursor: pointer;
    font-weight: 500;
  }
  @media (max-width: 500px) {
    .modal-content { width: 96vw; padding: 18px 4vw 16px 4vw;}
  }
  /* Task Board Styling */
  .task-board {
    display: flex;
    gap: 16px;
    margin-top: 24px;
    justify-content: space-between;
  }
  .column {
    background: #f1f5f9;
    border-radius: 10px;
    padding: 12px;
    flex: 1;
    min-width: 220px;
    min-height: 200px;
    box-shadow: 0 2px 8px #e0e7ff;
  }
  .column h2 {
    text-align: center;
    color: #6366f1;
    margin-bottom: 12px;
  }
  .task-item {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 1px 4px #e0e7ff;
    padding: 10px 12px;
    margin-bottom: 12px;
    font-size: 1rem;
    position: relative;
  }
  .task-actions {
    margin-top: 8px;
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
  }
  .task-actions button {
    background: #e0e7ff;
    color: #3730a3;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 0.95em;
    cursor: pointer;
    transition: background 0.2s;
  }
  .task-actions button:hover {
    background: #6366f1;
    color: #fff;
  }
  #task-error {
    margin-top: 8px;
    min-height: 20px;
  }
</style>
</body>
</html>
